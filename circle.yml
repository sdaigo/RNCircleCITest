machine:
  xcode:
    version: 8.3.3
dependencies:
  pre:
    - echo $PATH
    - ls ~/
  override:
    - which n || curl -L https://git.io/n-install | N_PREFIX=~/n bash -s -- -y 6.9.5
    - bundle check --path=vendor/bundle || bundle install --path=vendor/bundle --jobs=4 --retry=3 --without development
  post:
    - export PATH=~/n/bin:$PATH
    - source ~/.bash_profile
  cache_directories:
    - node_modules
    - vendor/bundle
    - ~/n

test:
  override:
    - echo 'skip test'

deployment:
  preview:
    branch: preview-markdown
    commands:
      - cd ios && bundle exec fastlane test

  release:
    branch: master
    commands:
      - cd ios && bundle exec fastlane release
